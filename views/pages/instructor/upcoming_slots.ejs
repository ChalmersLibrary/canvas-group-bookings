<!DOCTYPE html>
<html lang="en">
    <head>
        <%- include('../../partials/head'); %>
    </head>

    <body class="container-fluid float-start">

        <header>
            <%- include('../../partials/header', { user: session.user }); %>
        </header>

        <main class="container-fluid py-2">
            <h1>Mina tillfällen</h1>
            <p>Här ser du dina kommande tillfällen och vilka som är bokade på dem.</p>

            <% slots.forEach(slot => { %>
                <div class="card my-2" data-slot-id="<%= slot.id %>">
                    <div class="card-header">
                        <%= slot.course_name %>
                    </div>
                    <div class="card-body">
                        <h6 class="card-subtitle mb-2 text-muted"><%- slot.time_human_readable_sv %></h6>

                        <p class="card-text">
                            <%= slot.location_name %>                          
                        </p>

                        <p class="card-text">
                            <%= (slot.type == "group" ? "Grupptillfälle, max " + slot.res_max + " grupper" : "Individuellt tillfälle, max " + slot.res_max + " personer") %>
                        </p>
                        
                        <!--
                        <div class="progress-label-container col-md-5" style="position:relative;">
                            <div class="progress" style="height:36px;">
                                <div class="progress-bar bg-primary" role="progressbar" style="width: <%= slot.res_percent %>%;" aria-valuenow="<%= slot.res_percent %>" aria-valuemin="0" aria-valuemax="100"><%= slot.res_percent %>%</div>
                            </div>
                            <div class="progress-label" style="position:absolute; left:4%; top:10%;">
                                <small><%= slot.res_now + "/" + slot.res_max %></small>
                            </div>
                        </div>
                    -->

                        <% if (slot.reservations && slot.reservations.length) { %>
                            <p class="card-text">
                                <div>Bokade:</div>
                                <% if (slot.type == "group") { %>
                                    <div><%= slot.reservations.map(r => r.canvas_group_name).join(", ") %></div>
                                <% } else { %>
                                    <div><%= slot.reservations.map(r => r.canvas_user_name).join(", ") %></div>
                                <% } %>
                            </p>
                        <% } %>
                        <div class="button-bar">
                            <button type="button" title="Redigera" data-bs-toggle="modal" data-bs-target="#editSlot" data-bs-slot-id="<%= slot.id %>" class="btn btn-secondary btn-md"><i class="bi-pencil-fill"></i></button>
                            <button type="button" title="Radera" data-bs-toggle="modal" data-bs-target="#deleteSlot" data-bs-slot-id="<%= slot.id %>" class="btn btn-secondary btn-md"><i class="bi-trash-fill"></i></button>
                            <!--<button class="btn btn-primary btn-md" type="button" data-bs-toggle="offcanvas" data-bs-slot-id="<%= slot.id %>" data-bs-target="#offcanvasSlotDetails" aria-controls="offcanvasSlotDetails">Mer information</button>-->
                        </div>
                    </div>
                </div>
            <% }) %>
        </main>

        <footer>
            <%- include('../../partials/footer', { version: version }); %>
        </footer>

        <%- include('../../partials/instructor_upcoming_slots_offcanvas_details.ejs'); %>

        <% if (session.user.isAdministrator || session.user.isInstructor) { %>
            <%- include('../../partials/slots_admin_modal_new'); %>
            <%- include('../../partials/slots_admin_modal_edit'); %>
            <%- include('../../partials/slots_admin_modal_delete'); %>
        <% } %>
    </body>
</html>